<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H Restaurant | Descuento Exclusivo</title>
    <!-- Fuente de Google: Poppins para un look moderno -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- PALETA DE COLORES (H RESTAURANT) --- */
        :root {
            --h-dark: #262626;    /* Gris Oscuro */
            --h-sage: #889F97;    /* Verde Salvia */
            --h-rust: #BF6C3B;    /* Terracota */
            --h-brown: #59281D;   /* Marr√≥n oscuro */
            --h-white: #F2F2F2;   /* Blanco Hueso */
        }

        * { box-sizing: border-box; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle at top, #4a5c56 0%, #1a1a1a 100%);
            color: var(--h-white);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Tarjeta principal */
        .card {
            background-color: var(--h-dark);
            padding: 40px 35px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5); 
            border: 1px solid #333;
            border-top: 4px solid var(--h-sage);
            max-width: 450px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .logo-img {
            max-width: 160px;
            margin-bottom: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            mix-blend-mode: lighten; 
        }

        /* Tipograf√≠a */
        h1 {
            margin: 0 0 10px 0;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 1.8rem;
            color: var(--h-white);
            letter-spacing: 1px;
        }
        
        .subtitle {
            color: #ccc;
            font-size: 0.95rem;
            margin-bottom: 30px;
            line-height: 1.6;
            font-weight: 300;
        }

        h2.ai-title {
            font-size: 1.2rem;
            color: var(--h-sage);
            margin-top: 0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Formularios e Inputs */
        .input-group { margin-bottom: 20px; text-align: left; }
        
        label {
            font-size: 0.75rem;
            color: var(--h-sage);
            margin-left: 5px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: block;
            margin-bottom: 8px;
        }

        input, textarea {
            width: 100%;
            padding: 15px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 8px;
            color: var(--h-white);
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
            outline: none;
        }
        
        textarea {
            resize: none;
            height: 80px;
        }

        input:focus, textarea:focus {
            border-color: var(--h-rust);
            background: #111;
            box-shadow: 0 0 10px rgba(191, 108, 59, 0.2);
        }

        /* Botones */
        .btn-main {
            background: var(--h-rust);
            color: white;
            border: none;
            padding: 18px;
            width: 100%;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: background 0.3s, transform 0.2s;
            box-shadow: 0 4px 15px rgba(191, 108, 59, 0.3);
        }
        
        .btn-ai {
            background: linear-gradient(135deg, #4a5c56, var(--h-sage));
            font-size: 0.9rem;
            padding: 12px;
            margin-top: 10px;
        }

        .btn-main:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        /* Vistas */
        #success-view, #ai-section {
            display: none;
            animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* Cup√≥n */
        .coupon-box {
            background: #1f1f1f;
            border: 2px dashed var(--h-sage);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            position: relative;
        }

        .code-text {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--h-rust);
            letter-spacing: 3px;
            display: block;
            margin: 10px 0;
        }

        .small-note { font-size: 0.8rem; color: #888; font-weight: 400; }
        .success-icon { font-size: 3.5rem; margin-bottom: 15px; animation: popIn 0.5s; display: inline-block; }

        /* Secci√≥n AI */
        .ai-container {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid #333;
            text-align: left;
        }
        
        .ai-response {
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid var(--h-rust);
            padding: 15px;
            margin-top: 15px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
            line-height: 1.5;
            display: none;
            color: #ddd;
        }

        .ai-loading {
            display: none;
            color: var(--h-sage);
            font-size: 0.9rem;
            margin-top: 10px;
            text-align: center;
        }

        /* Loader General */
        .loader {
            display: none;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid var(--h-rust);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 25px auto;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.1); } 100% { transform: scale(1); } }

        @media (max-width: 480px) {
            .card { padding: 30px 25px; }
            h1 { font-size: 1.6rem; }
        }
    </style>
</head>
<body>

    <div class="card">
        <!-- VISTA 1: FORMULARIO DE REGISTRO -->
        <div id="form-view">
            <img src="logo de h restaurant-blackback.png" alt="H Restaurant Logo" class="logo-img">
            <h1>Black Friday</h1>
            <p class="subtitle">Reg√≠strate para desbloquear tu <strong>15% OFF</strong> exclusivo.</p>

            <form id="bf-form">
                <div class="input-group">
                    <label>Nombre Completo</label>
                    <input type="text" id="nombre" placeholder="Ej. Ana Garc√≠a" required>
                </div>
                <div class="input-group">
                    <label>Correo Electr√≥nico</label>
                    <input type="email" id="email" placeholder="ana@ejemplo.com" required>
                </div>
                <button type="submit" class="btn-main">QUIERO MI DESCUENTO</button>
            </form>
            <div class="loader" id="loader"></div>
        </div>

        <!-- VISTA 2: CUP√ìN + AI FEATURE -->
        <div id="success-view">
            <!-- LOGO TAMBI√âN EN LA VISTA DE √âXITO -->
            <img src="logo de h restaurant-blackback.png" alt="H Restaurant Logo" class="logo-img" style="max-width: 100px;">

            <div class="success-icon">üéÅ</div>
            <h1>¬°Ya es tuyo!</h1>
            
            <div class="coupon-box">
                <span class="small-note">TU C√ìDIGO √öNICO</span>
                <!-- C√ìDIGO FIJO (MISTERIOSO) -->
                <span class="code-text">H-BF9X2</span>
            </div>
            
            <div class="small-note" style="margin-bottom: 15px; line-height: 1.6; border-top: 1px solid #444; border-bottom: 1px solid #444; padding: 10px 0;">
                <strong>V√°lido solo el 28 y 29 de noviembre de 2025</strong><br>
                (Black Friday y S√°bado)<br>
                *No aplica en bebidas<br>
                *Toma una captura de pantalla y mu√©stralo al pagar
            </div>

            <!-- ‚ú® NUEVA SECCI√ìN AI: SOMMELIER VIRTUAL ‚ú® -->
            <div class="ai-container">
                <h2 class="ai-title"><i class="fa-solid fa-wand-magic-sparkles"></i> Sommelier Virtual</h2>
                <p class="small-note" style="margin-bottom: 10px;">¬øNo sabes qu√© pedir? Cu√©ntale al Chef tu antojo y recibe una recomendaci√≥n de nuestro men√∫.</p>
                
                <textarea id="ai-prompt" placeholder="Ej: Algo fresco con mariscos, una cena rom√°ntica, o sorpr√©ndeme con algo picante..."></textarea>
                
                <button id="btn-ask-ai" class="btn-main btn-ai">
                    <i class="fa-solid fa-utensils"></i> Obtener Recomendaci√≥n
                </button>

                <div class="ai-loading" id="ai-loading">
                    <i class="fa-solid fa-circle-notch fa-spin"></i> Consultando el men√∫...
                </div>

                <div class="ai-response" id="ai-result"></div>
            </div>

            <a href="#" onclick="location.reload()" style="color: var(--h-sage); text-decoration: none; font-size: 0.8rem; margin-top: 30px; display: block; border-top: 1px solid #333; padding-top: 15px;">Volver al inicio</a>
        </div>
    </div>

    <script>
        // Elementos del DOM
        const form = document.getElementById('bf-form');
        const formView = document.getElementById('form-view');
        const successView = document.getElementById('success-view');
        const loader = document.getElementById('loader');
        const btn = document.querySelector('.btn-main');
        
        // Elementos AI
        const btnAskAi = document.getElementById('btn-ask-ai');
        const aiPromptInput = document.getElementById('ai-prompt');
        const aiLoading = document.getElementById('ai-loading');
        const aiResult = document.getElementById('ai-result');

        // ------------------------------------------------------------------
        // 1. CONFIGURACI√ìN DE DATOS (SHEETDB) - INTEGRADA
        // ------------------------------------------------------------------
        const SHEETDB_API = 'https://sheetdb.io/api/v1/dbgtq17p477fy'; 

        // ------------------------------------------------------------------
        // 2. CONFIGURACI√ìN DE AI (GEMINI API) - INTEGRADA
        // ------------------------------------------------------------------
        const apiKey = "AIzaSyApmyUrAl3lr6GkDlqCMK3XSEqVlplsdgc"; 

        // ------------------------------------------------------------------
        // 3. CONTEXTO DEL MEN√ö (COMPLETO CON VINOS)
        // ------------------------------------------------------------------
        const MENU_CONTEXT = `
üçΩÔ∏è H RESTAURANT FUSI√ìN CREATIVA
En nuestra mesa, los sabores unen y los recuerdos perduran.

üçú SOPAS
- Sopa de gandules ($7): Sopa criolla de gandules con carne de res y carne de cerdo.

ü¶ê ENTRADAS
- Charcuter√≠a ($27): Prosciutto, salami, quesos manchego, quesos surtidos, pan baguette con queso crema y trufas, galletas de s√©samo, aceitunas, fresas y uvas.
- Wonton-Tar ($20): Wonton tacos rellenos de at√∫n tartar marinado en soya y ajonjol√≠, aguacate y un toque de spicy mayo.
- Pork Belly ($15): Crujiente pork belly glaseado de salsa bbq y guayaba.
- Croquetas de queso manchego ($11): Delicadas croquetas rellenas de queso manchego servidas con mayocilantro.

ü•ó ENSALADAS
- Ensalada Green Goddess ($12): Iceberg con aderezo de avocado ranch, trozos de tocineta, cranberries y blue cheese.
- Ensalada Caprese ($12): Tomates frescos, mozzarella y albahaca con un delicado toque de aceite de oliva y bals√°mico.

ü•© PLATOS PRINCIPALES
- Cazuela de garbanzos con dorado ($22): Garbanzos guisados con jam√≥n y chorizo de mejillones, almejas, calamares y dorado.
- Pechuga de pollo en salsa de setas ($22): Jugosa pechuga de pollo en salsa blanca con setas, acompa√±ada de vegetales salteados en mantequilla de romero y tomillo.
- Pechuga de pato en salsa de tamarindo ($30): Pechuga de pato en reducci√≥n de tamarindo acompa√±ada con papas salteadas aromatizadas con romero y tomillo.
- New York Steak 12oz ($35): Jugoso corte de New York de 12 oz a la parrilla terminado con una rica salsa demi-glace, acompa√±ado de esp√°rragos.
- Churrasco 12oz ($42): Tierna carne de churrasco de 12 oz en salsa asi√°tica servida con papas rizadas crujientes.
- Ribeye Steak 16oz ($50): Jugoso corte de ribeye de 16 oz a la parrilla terminado con una rica salsa demi-glace, acompa√±ado de esp√°rragos.

ü•ï ACOMPA√ëANTES
- Papas salteadas en mantequilla de romero ($7)
- Vegetales salteados ($7): Zanahoria, br√≥coli y calabac√≠n.
- Esp√°rragos salteados ($7)
- Pasta farfalle con setas y espinacas ($11)
- Risotto de setas ($12)
- Arroz Chof√°n ($13): Arroz asi√°tico del chef almendrado con vegetales.
- Mac & Cheese con trufas ($13)

üßí NI√ëOS
- Tenders de pollo con papas fritas ($12)

üç∞ POSTRES
- Cheesecake de berries ($13): Cheesecake frito cubierto con mantecado y coronado con mermelada de frutos rojos.
- Mousse de parcha ($9)
- Mousse de guayaba ($9)
- Bizcocho delirio de chocolate ($11)

üçπ SANGR√çAS DE LA CASA
- Flor de Calixta ($14)
- Melod√≠a de Ramonita ($14)

üç∑ CARTA DE VINOS (Selecci√≥n Exclusiva)
ESPUMOSOS:
- Cava No. 1 Brut Nature 2023
- Domaine Carneros Brut
- Piper-Heidsieck Cuv√©e Brut
- Passerina Spumante Brut ‚Äì Cantina di Castignano

BLANCOS:
- Recu√©rdame 2023
- Albamar Ceibo 2023
- Os Dunares 2023
- Chapirete Prefilox√©rico 2021
- Flor de Castel
- Ch√¢teau de Chamirey Mercurey Blanc 2022
- Octopoda Sauvignon Blanc 2023
- Submission Chardonnay
- Whitehaven Sauvignon Blanc 2020
- Marche Trebbiano IGT
- Castello di Corbara Orvieto Classico Superiore

ROSADOS:
- Alta Alella Laiet√† BN Gran Reserva Ros√© 2019
- Clos Santini Ros√© 2023

TINTOS:
- Yotuel Selecci√≥n 2019
- Furvus 2022
- La Rinconada 2023
- Por Ti 2021
- S√≠nodo Centales 2021
- Vi√±as del Lago 2020
- Mil Historias Bobal 2020
- The Chocolate Block 2022
- Miura Pinot Noir 2022
- Teeter Totter Red Wine 2021
- Caterwaul Napa Valley Cabernet 2022
- Craftwork Cabernet Sauvignon
- Abad√≠a Retuerta Selecci√≥n Especial
- Rama Cabernet Sauvignon
- Elizabeth Spencer Cabernet Sauvignon
- Penfolds Bin 28 Shiraz
- Cocodrilo Corte 2021
- Neyen, Esp√≠ritu de Apalta
- Salentein Reserva Cabernet Sauvignon 2022
- Jos√© Zuccardi
- Ghost Pines Cabernet Sauvignon 2013
- Treana Red Blend
- Parajes de Callejo
- Vendimia Seleccionada ‚Äì Pico Cuadro
- Austin Hope Cabernet Sauvignon 2023
- Les Collines 2020
- Marqu√©s de Gri√±√≥n Petit Verdot
- Co^lluvial ‚ÄúLas Nenas‚Äù Pinot Noir 2021
- Ugolini ‚ÄúHigh Valley‚Äù Amarone della Valpolicella 2015
- Lirac MysTerre Rouge 2022

‚ö†Ô∏è AVISO: Informar alergias antes de ordenar.
        `;


        // --- MANEJO DEL FORMULARIO DE REGISTRO ---
        form.addEventListener('submit', e => {
            e.preventDefault();
            btn.style.display = 'none';
            loader.style.display = 'block';

            // ‚ö†Ô∏è IMPORTANTE: Enviamos los datos como ARRAY para corregir el error de SheetDB
            const dataToSend = {
                data: [
                    {
                        "Nombre": document.getElementById('nombre').value,
                        "Email": document.getElementById('email').value,
                        "Fecha": new Date().toLocaleString()
                    }
                ]
            };
            
            // Usamos tu URL real directamente
            fetch(SHEETDB_API, {
                method: 'POST',
                headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' },
                body: JSON.stringify(dataToSend)
            })
            .then(res => res.json())
            .then(() => {
                showSuccess();
            })
            .catch(err => {
                console.error(err);
                alert('Error de conexi√≥n. Verifique SheetDB.');
                loader.style.display = 'none';
                btn.style.display = 'block';
            });
        });

        function showSuccess() {
            loader.style.display = 'none';
            formView.style.display = 'none';
            successView.style.display = 'block';
        }

        // --- L√ìGICA DEL SOMMELIER VIRTUAL (GEMINI API) ---
        btnAskAi.addEventListener('click', async () => {
            const userMood = aiPromptInput.value.trim();
            if (!userMood) return alert("Por favor escribe qu√© se te antoja.");

            // UI Updates
            btnAskAi.style.display = 'none';
            aiLoading.style.display = 'block';
            aiResult.style.display = 'none';

            try {
                // Construimos el Prompt MEJORADO (SIN TABLAS)
                const promptText = `
                    Act√∫a como el Chef Ejecutivo de H Restaurant.
                    
                    AQU√ç EST√Å NUESTRO MEN√ö OFICIAL (Usa SOLO opciones de aqu√≠):
                    ${MENU_CONTEXT}
                    
                    EL CLIENTE DICE: "${userMood}".
                    
                    TU TAREA:
                    1. Analiza el pedido y sugiere SIEMPRE hasta 3 opciones diferentes de platillos con sus maridajes de vinos ideales de nuestra lista.
                    2. Si el cliente pide algo muy espec√≠fico que solo tiene 1 opci√≥n, da esa opci√≥n.
                    3. Usa un tono sofisticado, apetitoso y amigable. Usa emojis.
                    4. IMPORTANTE: NO uses tablas ni formato de columnas. Usa listas simples o p√°rrafos.
                    
                    REGLA OBLIGATORIA FINAL:
                    Termina tu respuesta SIEMPRE invitando a ver el men√∫ completo con este enlace exacto: https://hrestaurant.glide.page
                `;

                // Llamada a Gemini API con tu Key Real
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: promptText }]
                            }]
                        })
                    }
                );

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }

                // Formatear la respuesta para que los enlaces sean clicables si Gemini devuelve markdown
                let aiText = data.candidates[0].content.parts[0].text;
                
                // Convertir URLs en enlaces clicables HTML
                aiText = aiText.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" style="color: var(--h-rust); text-decoration: underline;">$1</a>');
                
                // Reemplazar saltos de l√≠nea con <br> para mejor lectura
                aiText = aiText.replace(/\n/g, '<br>');
                
                // Limpieza extra: eliminar posibles marcas de tabla markdown residuales si aparecieran
                aiText = aiText.replace(/\|/g, ''); 

                // Mostrar Respuesta
                aiResult.innerHTML = `<strong>üßë‚Äçüç≥ Sugerencia del Chef:</strong><br><br>${aiText}`;
                aiResult.style.display = 'block';

            } catch (error) {
                console.error("Error AI:", error);
                aiResult.innerText = "El chef est√° ocupado en la cocina. Intenta de nuevo en un momento.";
                aiResult.style.display = 'block';
            } finally {
                aiLoading.style.display = 'none';
                btnAskAi.style.display = 'block';
                btnAskAi.innerHTML = '<i class="fa-solid fa-rotate-right"></i> Intentar otra opci√≥n';
            }
        });
    </script>
</body>
</html>
